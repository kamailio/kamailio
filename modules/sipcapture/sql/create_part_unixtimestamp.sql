/* 
 * only for MYSQL >= 5.1.58 and if you expect MASSIV SIP TRAFFIC
*/

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `sip_capture` (
  `id` int(20) NOT NULL AUTO_INCREMENT,
  `date` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
  `micro_ts` bigint(18) NOT NULL DEFAULT '0',
  `method` varchar(50) NOT NULL DEFAULT '',
  `reply_reason` varchar(100) NOT NULL,
  `ruri` varchar(200) NOT NULL DEFAULT '',
  `ruri_user` varchar(100) NOT NULL DEFAULT '',
  `from_user` varchar(100) NOT NULL DEFAULT '',
  `from_tag` varchar(64) NOT NULL DEFAULT '',
  `to_user` varchar(100) NOT NULL DEFAULT '',
  `to_tag` varchar(64) NOT NULL,
  `pid_user` varchar(100) NOT NULL DEFAULT '',
  `contact_user` varchar(120) NOT NULL,
  `auth_user` varchar(120) NOT NULL,
  `callid` varchar(100) NOT NULL DEFAULT '',
  `callid_aleg` varchar(100) NOT NULL DEFAULT '',
  `via_1` varchar(256) NOT NULL,
  `via_1_branch` varchar(80) NOT NULL,
  `cseq` varchar(25) NOT NULL,
  `diversion` varchar(256) NOT NULL,
  `reason` varchar(200) NOT NULL,
  `content_type` varchar(256) NOT NULL,
  `authorization` varchar(256) NOT NULL,
  `user_agent` varchar(256) NOT NULL,
  `source_ip` varchar(50) NOT NULL DEFAULT '',
  `source_port` int(10) NOT NULL,
  `destination_ip` varchar(50) NOT NULL DEFAULT '',
  `destination_port` int(10) NOT NULL,
  `contact_ip` varchar(60) NOT NULL,
  `contact_port` int(10) NOT NULL,
  `originator_ip` varchar(60) NOT NULL DEFAULT '',
  `originator_port` int(10) NOT NULL,
  `proto` int(5) NOT NULL,
  `family` int(1) DEFAULT NULL,
  `rtp_stat` varchar(256) NOT NULL,
  `type` int(2) NOT NULL,
  `node` varchar(125) NOT NULL,
  `msg` longblob NOT NULL,
  PRIMARY KEY (`id`,`date`),
  KEY `ruri_user` (`ruri_user`),
  KEY `from_user` (`from_user`),
  KEY `to_user` (`to_user`),
  KEY `pid_user` (`pid_user`),
  KEY `auth_user` (`auth_user`),
  KEY `callid_aleg` (`callid_aleg`),
  KEY `date` (`date`),
  KEY `callid` (`callid`)
) ENGINE=MyISAM AUTO_INCREMENT=1 DEFAULT CHARSET=utf8
PARTITION BY RANGE ( UNIX_TIMESTAMP(`date`) ) (
PARTITION p2011082500 VALUES LESS THAN (1314216000) ENGINE = MyISAM,
PARTITION p2011082501 VALUES LESS THAN (1314219600) ENGINE = MyISAM,
PARTITION p2011082502 VALUES LESS THAN (1314223200) ENGINE = MyISAM,
PARTITION p2011082503 VALUES LESS THAN (1314226800) ENGINE = MyISAM,
PARTITION p2011082504 VALUES LESS THAN (1314230400) ENGINE = MyISAM,
PARTITION p2011082505 VALUES LESS THAN (1314234000) ENGINE = MyISAM,
PARTITION p2011082506 VALUES LESS THAN (1314237600) ENGINE = MyISAM,
PARTITION p2011082507 VALUES LESS THAN (1314241200) ENGINE = MyISAM,
PARTITION p2011082508 VALUES LESS THAN (1314244800) ENGINE = MyISAM,
PARTITION p2011082509 VALUES LESS THAN (1314248400) ENGINE = MyISAM,
PARTITION p2011082510 VALUES LESS THAN (1314252000) ENGINE = MyISAM,
PARTITION p2011082511 VALUES LESS THAN (1314255600) ENGINE = MyISAM,
PARTITION p2011082512 VALUES LESS THAN (1314259200) ENGINE = MyISAM,
PARTITION p2011082513 VALUES LESS THAN (1314262800) ENGINE = MyISAM,
PARTITION p2011082514 VALUES LESS THAN (1314266400) ENGINE = MyISAM,
PARTITION p2011082515 VALUES LESS THAN (1314270000) ENGINE = MyISAM,
PARTITION p2011082516 VALUES LESS THAN (1314273600) ENGINE = MyISAM,
PARTITION p2011082517 VALUES LESS THAN (1314277200) ENGINE = MyISAM,
PARTITION p2011082518 VALUES LESS THAN (1314280800) ENGINE = MyISAM,
PARTITION p2011082519 VALUES LESS THAN (1314284400) ENGINE = MyISAM,
PARTITION p2011082520 VALUES LESS THAN (1314288000) ENGINE = MyISAM,
PARTITION p2011082521 VALUES LESS THAN (1314291600) ENGINE = MyISAM,
PARTITION p2011082522 VALUES LESS THAN (1314295200) ENGINE = MyISAM,
PARTITION p2011082523 VALUES LESS THAN (1314298800) ENGINE = MyISAM,
PARTITION pmax VALUES LESS THAN (MAXVALUE)
);


/* if your mysql < 5.5 drop maxvalue partition */
/* alter table homer_capture drop partition pmax; */
